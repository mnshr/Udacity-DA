# Exploring Prosper Loan Data by MNSHR
========================================================

This project analyzes the loan data provided by Prosper (www.prosper.com) a 
peer to peer lending platform. The feature description about the dataset can
be found at:
A variable dictionary can be found here: https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0.

I will perform three types of analyses, Univariate, Bivariate and Multivariate
using preselected variables among the 81 that are part of the dataset and
reflect on my findings in the concluding section. 

```{r echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(gridExtra)
library(dplyr)
library(RColorBrewer)
#library(ellipse)
library(reshape)
library(memisc)
library(scales)
library(pander)
library(knitr)
```
### Here is a summary of the dataset
```{r echo=TRUE, Load_the_Data}

# Load the Data
pd <- read.csv('./prosperLoanData.csv', sep=',')
#head(pd, 10) --cumbersome
str(pd) # Get the structure of data
dim(pd) # Get the size
names(pd) #Get all columns

```
# Univariate Plots Section

I start the Univariate analysis by developing graphs of select variables of my interest. 
I have divided these variables into 4 broad categories along with the variables represented by them:
 * Borrower - BorrowerRate, Occupation, EmploymentStatus, TotalInquiries, CurrentDeliquencies, RevolvingCreditBalance, OnTimeProsperPayments, DebtToIncomeRatio, IncomeRange
 * Loan - Term, LoanStatus, ProsperPrincipalBorrowed, LoanOriginationDate, LoanMonthsSinceOrigination, MonthlyLoanPayment, PercentFunded, ListingCategory
 * Credit - CreditScoreRangeLower, CreditScoreRangeUpper, FirstRecordedCreditLine, TotalCreditLinespast7years, ProsperRating, ProsperScore
 * Lender - LenderYield, EstimatedReturn

I will explore each variable to develop intuition about each.
### Borrower
#### BorrowerRate

```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univariate_Plots}

ggplot(aes(x = BorrowerRate), data = pd) + 
  geom_histogram(binwidth = 0.00500, fill = '#5760AB')
summary(pd$BorrowerRate)
```
I used a bin size of 0.5 in the histogram above. I shows a considerable peak at
0.35% rate with more than 5000 loans. The mean is around 0.2%

#### Occupation
```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univariate_Plots}

ggplot(data=pd,aes(Occupation))+
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
unique(pd$Occupation)
mutate(pd, Occupation_new = ifelse(Occupation %in% c("Engineer - Mechanical",
                                          "Scientist",
                                          "Engineer - Electrical",
                                          "Engineer - Chemical",
                                          "Chemist",
                                          "Biologist",
                                          "Computer Programmer",
                                          "Professor",
                                          "Pilot - Private/Commercial"
                                      ), "STEM Service",
                                   ifelse(Occupation %in% 
                                     c("Dentist",
                                      "Doctor",
                                      "Medical Technician",
                                      "Nurse\'s Aide",
                                      "Nurse (LPN)",
                                      "Nurse (RN)",
                                      "Pharmacist",
                                      "Psychologist"
                                      ), "Medical Service",
                                   ifelse(Occupation %in% 
                                     c("Professional",
                                        "Sales - Commission",
                                        "Clerical",
                                        "Teacher",
                                        "Accountant/CPA",
                                        "Food Service Management",
                                        "Administrative Assistant",
                                        "Social Worker",
                                        "Postal Service",
                                        "Analyst",
                                        "Sales - Retail",
                                        "Military Enlisted",
                                        "Flight Attendant",
                                        "Retail Management",
                                        "Military Officer",
                                        "Food Service Management",
                                        "Social Worker",
                                        "Police Officer/Correction Officer",
                                        "Teacher's Aide",
                                        "Homemaker"
                                      ), "General Service",
                                   ifelse(Occupation %in% 
                                     c("Executive",
                                          "Principal",
                                          "Judge",
                                          "Car Dealer",
                                          "Architect",
                                          "Attorney",
                                          "Investor",
                                          "Clergy",
                                          "Realtor",
                                          "Civil Service",
                                          "Religious"
                                      ), "Distinguished Service",                                                                                 ifelse(Occupation %in% 
                                     c("Tradesman - Mechanic",
                                        "Tradesman - Electrician",
                                        "Tradesman - Carpenter",
                                        "Tradesman - Plumber",
                                        "Contruction",
                                        "Landscaping"
                                      ), "Construction Service",
                                   ifelse(Occupation %in% 
                                     c("Laborer",
                                        "Bus Driver",
                                        "Fireman",
                                        "Waiter/Waitress",
                                        "Skilled Labor",
                                        "Food Service",
                                        "Other",
                                        "Truck Driver"
                                      ), "BCollar Service",
                                   ifelse (Occupation %in% 
                                     c("Student - College Freshman",
                                      "Student - College Graduate Student",
                                      "Student - College Junior",
                                      "Student - College Senior",
                                      "Student - College Sophomore",
                                      "Student - Community College",
                                      "Student - Technical School"
                                      ), "Student", "Other"
                                   ))))))))
```
The most popular Occupation entered is 'Other' and the next popular is the 'Professional' category.
We can group different occupation categories and revisit this chart. For example there are 
multiple categories beginning with Student. There are about 70+ types of occupations listed in the dataset. I will try to reduce that to around 7

```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univariate_Plots}
ggplot(data=pd,aes(Occupation_new))+
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univariate_Plots}
ggplot(aes(x = LoanOriginalAmount), data = pd) + 
  geom_histogram(binwidth = 1000, fill = '#5760AB') + 
  scale_x_continuous(breaks = seq(0, 113, 5))

```

```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Bivariate_Plots}

summary(pd$StatedMonthlyIncome)
  ggplot(data=pd,aes(StatedMonthlyIncome)) +       
  geom_histogram(binwidth=500, color=I('black'), fill=I("#c5831d") ) + 
  xlim(0,10000)
summary(pd$StatedMonthlyIncome)

ggplot(data=pd,aes(Term)) + 
  geom_bar(color=I('blue'),fill=I('#78D20b'))

ggplot(data=pd,aes(MonthlyLoanPayment))+
  geom_histogram(binwidth=50,color=I('red'),fill=I('#56B4E9'))+
  scale_x_continuous(limits=c(0,2252),breaks=seq(0,2252,100))

#pandoc.table(pd$CreditGrade, style = "grid", caption = "Hello caption!")
#pander(summary(pd$CreditGrade))
#pander(summary(pd$MonthlyLoanPayment))
summary(pd$Term)
summary(pd$StatedMonthlyIncome)
summary(pd$LoanOriginalAmount)
table(pd$BorrowerState)

ggplot(pd,aes(x=BorrowerState))+
  geom_bar()+
  scale_y_log10()+
  theme(axis.text.x = element_text(face="bold",  
                           size=8, angle=45),
          axis.text.y = element_text(face="bold",  
                           size=8))

ggplot(pd,aes(x=BorrowerState))+
  geom_bar()+
  scale_y_log10()+
  theme(axis.text.x = element_text(face="bold",  
                           size=8, angle=45),
          axis.text.y = element_text(face="bold",  
                           size=8))

ggplot(pd,aes(x=LoanStatus))+
  geom_bar()+
  scale_y_log10()+
  theme(axis.text.x = element_text(face="bold",  
                           size=10, angle=45),
          axis.text.y = element_text(face="bold",  
                           size=10))

ggplot(data=pd,aes(x=DebtToIncomeRatio))+
  geom_histogram(binwidth=0.1)+
  scale_x_continuous(limits=c(0,1),breaks=seq(0,1,0.1))

ggplot(data=pd,aes(x=IsBorrowerHomeowner))+
  geom_bar()+
  scale_y_continuous(limits=c(0,10000),breaks=seq(0,10000,500))
summary(pd$IsBorrowerHomeowner)

qplot(data = pd, x=InquiriesLast6Months, binwidth=3)
qplot(data = pd, x=TotalCreditLinespast7years, binwidth=1)
qplot(data = pd, x=OpenCreditLines, binwidth=1)
qplot(data = pd, x=BorrowerAPR, binwidth = .01)

#qplot(pd= loans, x = ProsperCreditGrade) +
#  facet_wrap(~CreditSystem)

#Mean Credit Score
pd$MeanCreditScore <- (pd$CreditScoreRangeLower+pd$CreditScoreRangeUpper)/2
qplot(data = pd, x=MeanCreditScore, binwidth = 10)


summary(pd$CreditGrade)
summary(pd$ProsperRating..Alpha.)
summary(pd$PDCreditGrade)
pd$PDCreditGrade <- 
  as.factor(ifelse(pd$ProsperRating..Alpha. == "", 
                   as.character(pd$CreditGrade), 
                   as.character(pd$ProsperRating..Alpha.)))
```
####  Tip When plotting on a log scale, it is useful to note that 3 is about halfway between 1 and 10. As a side note, try not to plot counts on a log scale since counts of 0 are undefined and counts of 1 have a value of 0 (no height).
##### Tip: You can change the height and width of plots in code chunks with the fig.height and fig.width parameters in the chunk options.

# Univariate Analysis

### What is the structure of your dataset?

A cursory look at all the variables shows that all the variables could be part of a model to determine a measure of risk involved for each loan entry. And based on individual data per customer one could create another model to determine the credit rating of a borrower. At a macro level we could also determine the state of peer to peer lending business from the perspective of Prosper. 

### What is/are the main feature(s) of interest in your dataset?

When I use popular credit related apps such as CreditKarma and CreditWise I am shown some of the factors that determine my credit rating, these factors include - Oldest credit line, % of credit used, available credit across all credit lines, number of credit enquiries, number of accounts opened and closed, on time payments. This sounds much simpler than the number of variables at hand in the Prosper loan data. Hence I tried to categorize all the 81 variables in broad categories as per my own understanding of the credit industry. The categories and respective variables of my interest include:
  Credit - CreditScoreRangeLower, CreditScoreRangeUpper, FirstRecordedCreditLine, TotalCreditLinespast7years, ProsperRating, ProsperScore
  Lender - LenderYield, EstimatedReturn
  Borrower - BorrowerRate, Occupation, EmploymentStatus, TotalInquiries, CurrentDeliquencies, RevolvingCreditBalance, OnTimeProsperPayments, DebtToIncomeRatio, IncomeRange
  Loan - Term, LoanStatus, ProsperPrincipalBorrowed, LoanOriginationDate, LoanMonthsSinceOrigination, MonthlyLoanPayment, PercentFunded, ListingCategory

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

  Borrower - StatedMonthlyIncome, InvestmentFromFriendsCount, InvestmentFromFriendsAmount, BorrowerState, AmountDelinquent, InquiriesLast6Months, DelinquenciesLast7Years, TradesNeverDelinquent, BankcardUtilization, IsBorrowerHomeOwner

### Did you create any new variables from existing variables in the dataset?

* CreditScoreRange by combining the Lower and Upper and taking an average
* Since there are a large number of ListingCategory types, I logically grouped them into 5 and created ListingCategories5.
* Occupation grouped together to create smaller number of categories - Occupation5
* Combined ProsperRating and ProsperScore

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?


# Bivariate Plots Section
```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Bivariate_Plots}

```

# Bivariate Analysis

#### Tip: Be mindful of the number of data points and variables that you put in a correlation matrix or plot matrix: you do not need to include all variables. In addition, you can use other packages not introduced in the associated course to conduct your exploration. Make sure you load them at the beginning of your document so that it is easiest to see which packages are necessary. (The above plot matrix comes from the psych package.)

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

#### Tip: Even when doing exploration, it can be good to select appropriate color palettes and set plot themes in order to make plots more readable. (The above plots use sequential color palettes from the RColorBrewer package; other variables might require qualitative or diverging palettes.)

```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

#### Tip: Note that performing statistical tests and creating data models are not a required component of the project. Below, the mtable() call uses 'sdigits = 3' to make sure that three digits are printed after the decimal point in the summary statistics.

------

# Final Plots and Summary
#### Tip: Polish up the plots that you explored earlier in the report in the final plots section. Make sure you label and title the plots, and provide a description of what can be observed in each of the chosen plots.
### Plot One
```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Plot_Three}

```

### Description Three

------

# Reflection
