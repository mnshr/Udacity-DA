# Data Analyst NanoDegree - Explore and Summarize Data

Exploring Prosper Loan Data by MNSHR
========================================================

This project analyzes the loan data provided by Prosper (www.prosper.com) a 
peer to peer lending platform. The feature description about the dataset can
be found at:
A variable dictionary can be found here: https://docs.google.com/spreadsheets/d/1gDyi_L4UvIrLTEC6Wri5nbaMmkGmLQBk-Yx3z0XDEtI/edit#gid=0.

I will perform three types of analyses, Univariate, Bivariate and Multivariate
using preselected variables among the 81 that are part of the dataset and
reflect on my findings in the concluding section. 

```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=TRUE, warning=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(knitr)
library(grid)
library(gtable)
library(gridExtra)
library(lattice)

```
### Here is a summary of the dataset
```{r echo=FALSE, warning=FALSE, message=FALSE, Load_the_Data}

# Load the Data
pd <- read.csv('./prosperLoanData.csv', sep=',')
#head(pd, 10) --cumbersome
str(pd) # Get the structure of data
dim(pd) # Get the size
#names(pd) #Get all columns

```
# Univariate Plots Section

I start the Univariate analysis by developing graphs of select variables of my interest. 
I have divided these variables into 4 broad categories along with the variables represented by them:
 * Borrower - BorrowerRate, Occupation, EmploymentStatus, TotalInquiries, CurrentDeliquencies, RevolvingCreditBalance, OnTimeProsperPayments, DebtToIncomeRatio, IncomeRange
 * Loan - Term, LoanStatus, ProsperPrincipalBorrowed, LoanOriginationDate, LoanMonthsSinceOrigination, MonthlyLoanPayment, PercentFunded, ListingCategory
 * Credit - CreditScoreRangeLower, CreditScoreRangeUpper, FirstRecordedCreditLine, TotalCreditLinespast7years, ProsperRating, ProsperScore
 * Lender - LenderYield, EstimatedReturn, EstimatedLoss

I will explore each variable to develop intuition about each.

### Borrower

#### BorrowerRate

```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path='cache/', fig.path='figure/', Univar_BR}
grid.arrange(ggplot(aes(x = BorrowerRate), data = pd) + 
  geom_histogram(binwidth = 0.00500, fill = '#5760AB'),
  ggplot(pd, aes( x = 1, y = BorrowerRate )) + 
               geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)
summary(pd$BorrowerRate)
```

I used a bin size of 0.5 in the histogram above. I shows a considerable peak at
0.35% rate with more than 5000 loans. The mean is around 0.2%

#### Occupation
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path='cache/', fig.path='figure/', fig.height=9, fig.width=9, Univar_Occup}

ggplot(data=pd,aes(Occupation))+
  geom_bar() +
  scale_y_log10()+  
  theme(axis.text.x = element_text(angle = 60, hjust = 1))
unique(pd$Occupation)
pd <- mutate(pd, Occupation_new = ifelse(Occupation %in% 
                                           c("Engineer - Mechanical",
                                          "Scientist",
                                          "Engineer - Electrical",
                                          "Engineer - Chemical",
                                          "Chemist",
                                          "Biologist",
                                          "Computer Programmer",
                                          "Professor",
                                          "Pilot - Private/Commercial"
                                      ), "STEM Service",
                                   ifelse(Occupation %in% 
                                     c("Dentist",
                                      "Doctor",
                                      "Medical Technician",
                                      "Nurse\'s Aide",
                                      "Nurse (LPN)",
                                      "Nurse (RN)",
                                      "Pharmacist",
                                      "Psychologist"
                                      ), "Medical Service",
                                   ifelse(Occupation %in% 
                                     c("Professional",
                                        "Sales - Commission",
                                        "Clerical",
                                        "Teacher",
                                        "Accountant/CPA",
                                        "Food Service Management",
                                        "Administrative Assistant",
                                        "Social Worker",
                                        "Postal Service",
                                        "Analyst",
                                        "Sales - Retail",
                                        "Military Enlisted",
                                        "Flight Attendant",
                                        "Retail Management",
                                        "Military Officer",
                                        "Food Service Management",
                                        "Social Worker",
                                        "Police Officer/Correction Officer",
                                        "Teacher's Aide",
                                        "Homemaker"
                                      ), "General Service",
                                   ifelse(Occupation %in% 
                                     c("Executive",
                                          "Principal",
                                          "Judge",
                                          "Car Dealer",
                                          "Architect",
                                          "Attorney",
                                          "Investor",
                                          "Clergy",
                                          "Realtor",
                                          "Civil Service",
                                          "Religious"
                                      ), "Distinguished Service",                                                                                 ifelse(Occupation %in% 
                                     c("Tradesman - Mechanic",
                                        "Tradesman - Electrician",
                                        "Tradesman - Carpenter",
                                        "Tradesman - Plumber",
                                        "Contruction",
                                        "Landscaping"
                                      ), "Construction Service",
                                   ifelse(Occupation %in% 
                                     c("Laborer",
                                        "Bus Driver",
                                        "Fireman",
                                        "Waiter/Waitress",
                                        "Skilled Labor",
                                        "Food Service",
                                        "Other",
                                        "Truck Driver"
                                      ), "BCollar Service",
                                   ifelse (Occupation %in% 
                                     c("Student - College Freshman",
                                      "Student - College Graduate Student",
                                      "Student - College Junior",
                                      "Student - College Senior",
                                      "Student - College Sophomore",
                                      "Student - Community College",
                                      "Student - Technical School"
                                      ), "Student", "Other"
                                   ))))))))
```

The most popular Occupation entered is 'Other' and the next popular is the 'Professional' category.
We can group different occupation categories and revisit this chart. For example there are 
multiple categories beginning with Student. There are about 70+ types of occupations listed in the dataset. I will try to reduce that to around 7

```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_ON}
ggplot(data=subset(pd, !is.na(Occupation_new)),aes(Occupation_new))+
  geom_bar(fill = '#78D20b') +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

With the new Occupation categorization, we see the most of the loans come from "General Service" and "Blue Collar Services" jobs, although the number of people belonging to these must be high as well and hence a large number of loans.

#### EmploymentStatus

```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Emp}
summary(pd$EmploymentStatus)
ggplot(aes(EmploymentStatus), data = subset(pd, !is.na(EmploymentStatus))) +
  scale_y_log10() +
  geom_bar(fill = '#5760AB') 

ggplot(aes(x = EmploymentStatusDuration), 
       data = subset(pd, !is.na(EmploymentStatusDuration))) + 
  geom_histogram(binwidth=3, fill = '#5760AB')
summary(pd$EmploymentStatusDuration)
```

A large number of borrowers are employed, the number being 67322+26355 or ~93000 including both Full-Time and Employed categories. The EmploymentStatusDuration graph shows a steady decline in the number of loans holders as the employment duration increases. Median is 67 month whereas max is 755 months. 

#### TotalInquiries
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Inq}
grid.arrange(ggplot(aes(x = TotalInquiries), 
  data = subset(pd, !is.na(TotalInquiries))) + 
  scale_y_log10()+
  geom_histogram(binwidth=10, fill = '#78D20b'),
  ggplot(pd, aes( x = 1, y = TotalInquiries )) + 
              scale_y_log10()+
               geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

summary(pd$TotalInquiries)
```

TotalInquiries have an impact on credit and the summary and the graph show that although the graph peaks in the range of 0 to 6 enquiries, there are few who have inquired for more than 100 times and the max is 379 which is unusually high. I converted the scale on Y axis to log.

#### RevolvingCreditBalance
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_RCB}

grid.arrange(ggplot(aes(x = RevolvingCreditBalance), 
  data = subset(pd, !is.na(RevolvingCreditBalance))) + 
  scale_y_log10()+
  geom_histogram(binwidth=5000, fill = '#5760AB'),
  ggplot(pd, aes( x = 1, y = RevolvingCreditBalance )) + 
              scale_y_log10()+
               geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

summary(pd$RevolvingCreditBalance)
```

The log scaled histogram of RevolvingCreditBalance shows a large number of loans with low credit balance but there are many with greater than 50000 and even few with 0.5 million as credit balance.

#### OnTimeProsperPayments
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Payments}

grid.arrange(ggplot(aes(x = OnTimeProsperPayments), 
  data = subset(pd, !is.na(OnTimeProsperPayments))) + 
    scale_y_log10()+
  geom_histogram(binwidth=3, fill = '#78D20b'),
  ggplot(pd, aes( x = 1, y = OnTimeProsperPayments )) + 
              scale_y_log10()+
               geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

summary(pd$OnTimeProsperPayments)
```

This feature shows the number of on time payments the borrower had made on Prosper loans at the time they created this listing. This value will be null if the borrower has no prior loans and hence there are around 92000 entries with NULL. Although this would depend on Term of the loan, the count of on time loans seems to decline as the duration of ontime payment rises.

#### DebtToIncomeRatio
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_DTI}
ggplot(aes(x = DebtToIncomeRatio), 
  data = subset(pd, !is.na(DebtToIncomeRatio))) + 
  geom_histogram(binwidth=0.1, fill = '#5760AB')

grid.arrange(ggplot(data=subset(pd, !is.na(DebtToIncomeRatio)),
                    aes(x=DebtToIncomeRatio))+
  geom_histogram(binwidth=0.1, fill = '#5760AB')+
  scale_x_continuous(limits=c(0,1),breaks=seq(0,1,0.1)),
  ggplot(pd, aes( x = 1, y = DebtToIncomeRatio )) + 
              scale_y_log10()+
               geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

summary(pd$DebtToIncomeRatio)
```

The DebtToIncomeRatio is an important feature in determining the credit score of a loan as it indicates the probability of default as the debt-to-income ratio increases. In this histogram, the ratio is 0.2 to 0.3 for more than 30000, the peak. It then declines, but there are few loans which have the ratio as 10, an unusually high number.

#### IncomeRange 
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Inc}

ggplot(data=subset(pd, !is.na(IncomeRange)),aes(IncomeRange))+
  geom_bar(fill = '#78D20b') +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
summary(pd$IncomeRange)
```

The IncomeRange histogram looks like a normally distributed one wih a large number of loan takers reporting a salary in 25k-50k and 50k-75k ranges. The number of loans with lower and higher salary ranges are small for understandable reasons.

#### StatedMonthlyIncome

```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Sti}

ggplot(data=subset(pd, !is.na(StatedMonthlyIncome)),
  aes(StatedMonthlyIncome)) +       
  geom_histogram(binwidth=500, fill=I("#5760AB") ) + 
    scale_y_log10()

grid.arrange(ggplot(data=subset(pd, !is.na(StatedMonthlyIncome)),
  aes(StatedMonthlyIncome)) +       
  geom_histogram(binwidth=500, fill=I("#5760AB") ) + 
    #scale_y_log10()+
  xlim(0,10000),
  ggplot(pd, aes( x = 1, y = StatedMonthlyIncome)) + 
              scale_y_log10()+
               geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)
summary(pd$StatedMonthlyIncome)
```

The StatedMonthlyIncome also shows an approximate normal distribution, with monthly salary ranging from 0 to 175k. The median is 4667.

#### BorrowerState
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_ST}
table(pd$BorrowerState)

ggplot(subset(pd, !is.na(BorrowerState)),aes(x=BorrowerState))+
  geom_bar(fill=I("#78D20b"))+
  scale_y_log10()+
  theme(axis.text.x = element_text(face="bold",  
                           size=8, angle=45),
          axis.text.y = element_text(face="bold",  
                           size=8))
```

The borrowers are in large numbers from CA at more than 14000, hence I had to log transform the Y axis to plot the state histogram. 

### Loan
#### Term
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Term}
ggplot(data=subset(pd, !is.na(Term)),aes(Term)) + 
  geom_bar(color=I('blue'),fill=I('#5760AB'))
summary(pd$Term)
```

The loan terms are 3 categories, 12, 36 and 60 months with 36 being the most preferred loan term.

#### MonthlyLoanPayment
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_MPay}
grid.arrange(ggplot(data=subset(pd, !is.na(MonthlyLoanPayment)),
                  aes(MonthlyLoanPayment))+
geom_histogram(binwidth=50,fill=I('#78D20b'))+
theme(axis.text.x = element_text(size=10, angle = 60, hjust = 1)) +
scale_x_continuous(limits=c(0,2252),breaks=seq(0,2252,100)),
ggplot(pd, aes( x = 1, y = MonthlyLoanPayment)) + 
          scale_y_log10()+
           geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

summary(pd$MonthlyLoanPayment)
```

Most monthly loan payments lie between 100 and 300, and then few are even above 1000. There are some with 0 payments which looks unusual.

#### LoanOriginalAmount

```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_LoanAmt}
grid.arrange(ggplot(aes(x = LoanOriginalAmount), data = 
         subset(pd, !is.na(LoanOriginalAmount))) + 
  geom_histogram(binwidth = 1000, fill = '#5760AB'),
ggplot(pd, aes( x = 1, y = LoanOriginalAmount)) + 
          #scale_y_log10()+
           geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

summary(pd$LoanOriginalAmount)
```

The loans range from a minimum of 1000 to 35000, with median at 6500. 10000 and 15000 are popular loan amounts as well.

#### LoanStatus
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Stat}
ggplot(data=subset(pd, !is.na(LoanStatus)),aes(LoanStatus))+
  geom_bar(color=I('black'),fill=I('#78D20b')) +
  theme(axis.text.x = element_text(face="bold", size=10, 
                                   angle = 60, hjust = 1))

ggplot(subset(pd, !is.na(LoanStatus)),aes(x=LoanStatus))+
  geom_bar(fill=I('#78D20b'))+
  scale_y_log10()+
  theme(axis.text.x = element_text(face="bold",  
                           size=10, angle=45),
          axis.text.y = element_text(face="bold",  
                           size=10))
table(pd$LoanStatus)
summary(pd$LoanStatus)
```

The current status of the loan: Cancelled,  Chargedoff, Completed, Current, Defaulted, FinalPaymentInProgress, PastDue. The PastDue status will be accompanied by a delinquency bucket. Most loans are current, with 56k loans; more than 38k loans are completed. About 12k loans are chargedoff, there are 5k defaults and about 2k loans are past due for multiple durations.

#### LoanMonthsSinceOrigination
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Age}

grid.arrange(ggplot(aes(LoanMonthsSinceOrigination), 
  data = subset(pd, !is.na(LoanMonthsSinceOrigination))) + 
  geom_histogram(binwidth = 3, fill = '#5760AB') ,
ggplot(pd, aes( x = 1, y = LoanMonthsSinceOrigination)) + 
          #scale_y_log10()+
           geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)
summary(pd$LoanMonthsSinceOrigination)
```

LoanMonthsSinceOrigination: Number of months since the loan originated.
A large number of loansare relateively new with less than one year in age.

### Credit
#### CreditScoreRangeLower and CreditScoreRangeUpper
I will combine these 2 into a single variable and plot a histogram
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_Credit}
pd$CreditRange <- paste(pd$CreditScoreRangeLower,"_",pd$CreditScoreRangeUpper)
ggplot(subset(pd, !is.na(CreditRange)), aes(reorder(CreditRange, -table(CreditRange)[CreditRange]))) + 
  geom_bar(fill=I('#78D20b')) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
dim(subset(pd,CreditScoreRangeUpper <739 & 
             CreditScoreRangeLower >640))[1]/dim(pd)[1]
dim(subset(pd,CreditScoreRangeUpper <600 | 
             is.na(CreditScoreRangeUpper)))[1]/dim(pd)[1]

summary(pd$CreditRange)

#Mean Credit Score
pd$MeanCreditScore <- (pd$CreditScoreRangeLower+pd$CreditScoreRangeUpper)/2

grid.arrange(qplot(data = pd, x=MeanCreditScore, binwidth = 10),
ggplot(pd, aes( x = 1, y = MeanCreditScore)) + 
          #scale_y_log10()+
           geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

```

The graph shows that most loans go to borrowers with credit scores between 640 and 740.
About 42% of loans have credit score between 640 and 740.
About 6% of loans are to borrowers with credit below 600 or no credit rating at all. 

#### BankCardUtilization
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_BC}

grid.arrange(ggplot(subset(pd, !is.na(BankcardUtilization)),
                    aes(BankcardUtilization)) + 
  geom_density() + xlim(c(0,2)),
ggplot(pd, aes( x = 1, y = BankcardUtilization)) + 
          #scale_y_log10()+
           geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)

summary(pd$BankcardUtilization)
```

BankCardUtilization measures the credit utilization when the credit was pulled, the median is 0.6. There are more than 7500 NAs, which means they were taking credit first time. The density plot shows peaks at 0 and 1.

#### ProsperScore
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_PS}

grid.arrange(ggplot(aes(x = ProsperScore), 
                    data = subset(pd, !is.na(ProsperScore))) + 
  geom_histogram(binwidth = 1, fill = '#5760AB'),
ggplot(pd, aes( x = 1, y = ProsperScore)) + 
          #scale_y_log10()+
           geom_boxplot(alpha = 0.8, color = 'brown'), ncol=2)
summary(pd$ProsperScore)
```

A custom risk score built using historical Prosper data. The score ranges from 1-10, with 10 being the best, or lowest risk score.  Applicable for loans originated after July 2009.
The graph shows an almost normal distribution.

### CreditGrate and ProsperRating
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Univar_PR}

pd$ProsperCreditRating <- as.factor(ifelse(pd$ProsperRating..Alpha. == "", 
                   as.character(pd$CreditGrade), 
                   as.character(pd$ProsperRating..Alpha.)))

ggplot(aes(x = ProsperCreditRating), data = 
         subset(pd, !is.na(ProsperCreditRating))) + 
  geom_bar(fill = '#78D20b') 

summary(pd$CreditGrade)
summary(pd$ProsperRating..Alpha.)

```

I have combined the 2 pre2009 and post2009 credit rating measures in the dataset to a new feature called ProsperCreditRating. After plotting a histogram of the same w can see that most of the loans belong to Ratings, B, C and D which is not unusual.

# Univariate Analysis

### What is the structure of your dataset?

A cursory look at all the variables shows that all the variables could be part of a model to determine a measure of risk involved for each loan entry. And based on individual data per loan one could create another model to determine the credit rating of a borrower for a particular loan. Here I assume that credit rating is a dynamic metric which is evaluated on a regular basis based on the repayment pattern during loan servicing perdied. At a macro level we could also determine the state of peer to peer lending business from the perspective of Prosper. 

### What is/are the main feature(s) of interest in your dataset?

When I use popular credit related apps such as CreditKarma and CreditWise I am shown some of the factors that determine my credit rating, these factors include - Oldest credit line, % of credit used, available credit across all credit lines, number of credit enquiries, number of accounts opened and closed, on time payments. This sounds much simpler than the number of variables at hand in the Prosper loan data. Hence I tried to categorize all the 81 variables in broad categories as per my own understanding of the credit industry. The categories and respective variables of my interest include:
  Borrower - BorrowerRate, Occupation, EmploymentStatus, TotalInquiries, CurrentDeliquencies, RevolvingCreditBalance, OnTimeProsperPayments, DebtToIncomeRatio, IncomeRange, BorrowerState  
  Loan - Term, LoanStatus, LoanMonthsSinceOrigination, MonthlyLoanPayment, ListingCategory
  Credit - CreditScoreRangeLower, CreditScoreRangeUpper, ProsperRating, ProsperScore

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

  Borrower - StatedMonthlyIncome, InvestmentFromFriendsCount, InvestmentFromFriendsAmount, BorrowerState, AmountDelinquent, InquiriesLast6Months, DelinquenciesLast7Years, TradesNeverDelinquent, BankcardUtilization, IsBorrowerHomeOwner
  Loan - PercentFunded, ProsperPrincipalBorrowed, LoanOriginationDate, ListingCategory
  Credit - FirstRecordedCreditLine, TotalCreditLinespast7years

### Did you create any new variables from existing variables in the dataset?

Yes, following are the variables I derived from the dataset:
* CreditScoreRange by combining the Lower and Upper as a string
* MeanCreditScore by averaging the Lower and Upper as a number
* Occupation grouped together to create smaller number of categories - Occupation_new
* Combined ProsperRating..Alpha and CrediGrade to create ProsperCreditRating

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

For almost all variables I remove NA by default if any from the variable that I was going to plot. Apart from this I also did log and squre root transofrmations of disproportionate variables such as RevolvingCreditBalance, State and LoanStatus histograms. Occupation_new is a kind of redefinition of Occupation categorical variable which I used to group together similar categories to make analysis simpler. I also tried to set limits on x or y axes for better viewing of the data and remove outliers.

# Bivariate Plots Section

I will be exploring the relationship among pairs of variables in this section. Beginning with a correlation matrix chart to get an idea in general about the relationship among variables I got me interested in the Univariate analysis section.

```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', fig.width=10, fig.height=10, Bivar_corr}

ggcorr(dplyr::select(pd, 5, 9, 16, 21, 26, 27, 30:38, 41, 42, 47, 50, 52, 54, 
                     57, 58, 60, 62, 64, 81, 85), #9:18
       low = "darkgreen", mid = "white", high = "darkblue", label = FALSE, 
       angle = -15, size = 4, hjust = 0.9, label_round = 2, layout.exp = 2) +
  ggtitle("Correlation Matrix")

```

The generated graph is extremely busy but I am able to identify some of the variables which don't show much correlation with others. Variables such as Term, EmploymentStatusDuration, ProsperScore, LoanCurrentDaysDelinquent, DelinquenciesLast7Years, ProsperPrincipalOutstanding are not showing correlation with others and hence I removed them in the following correlation matrix to reduce the density of information in the matrix.

```{r echo=FALSE, fig.path='figure/', warning=FALSE, message=FALSE, cache=TRUE, cache.path='cache/',fig.width=10, fig.height=10, Bivar_corr2}
#MeanCreditScore, ProsperCreditRating

# Correlation matrix among numerical variables
ggcorr(dplyr::select(pd, 9, 26, 27, 30:35, 37, 41, 42, 47, 50, 52, 54, 57, 62,
                     64, 81, 85), #9:18
       low = "darkgreen", mid = "white", high = "darkblue", label = FALSE, 
       angle = -15, size = 4, hjust = 0.9, label_round = 2, layout.exp = 2, 
       geom = "circle") +
  ggtitle("Correlation Matrix")
```

There are some interesting observations in the graph above. First of all we can ignore the correlation of 1 among MeanCreditScore and the 2 CreditScoreRange [Upper/Lower] variables, since the mean is derived from the 2. The 4 variables, OpenRevolvingMonthlyPayment, OpenRevolvingAccounts, OpenCreditLines and TotalCreditLinesPast7Years are all strongly related to each other ranging from 0.5 to 0.82
Next highest correlation is between RevolvingCreditBalance and OpenRevolvingMonthlyPayment at 0.76, indicating that the payment tends to be usually equal to the Balance amount although it may not be always the case. The correlation between TotalInquiries and InquiriesLast6Months is also strong at 0.74, which is an obviously strong relationship. TotalProsperLoans and OnTimeProsperPayments correlation is at 0.7 which indicates that the On time payment record is a strong factor in getting the borrowers more loans.
On the negative correlation front, variables BorrowerRate, MeanCreditScore show a correlation of -0.46 while MeanCreditScore and BankCardUtilization show a correlation score of -0.41.

In my analysis further I will also include the categorical variables along with continuous ones.

#### MeanCreditScore vs LoanOriginalAmount
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', fig.height=6, fig.width=9, Bivar_Loan}
cor.test(pd$MeanCreditScore, pd$LoanOriginalAmount)
#ggplot(aes(x = LoanOriginalAmount, y = MeanCreditScore),
#       data = subset(pd, !is.na(LoanOriginalAmount))) +
#  scale_x_sqrt()+
#  geom_line(stat='summary', fun.y=median, fun.x=median) +
#  coord_cartesian(ylim = c(400,850)) + 
#  geom_smooth()

ggplot(aes(x=LoanOriginalAmount, y=MeanCreditScore, color=ProsperCreditRating),
       data=subset(pd, !is.na(LoanOriginalAmount))) + 
  geom_jitter(alpha=0.20, aes(color=ProsperCreditRating)) +
  geom_smooth(aes(LoanOriginalAmount, 
                    MeanCreditScore))

```

We can observe a general increasing trend of MeanCreditScore as the LoanOriginalAmount increases. The loan amount is square root transformed. Although the graph shows lot of variation in Credit Score for most of the loan amounts, except the very high ones. At high loan amounts the Credit Scores are found to be among the highest.

#### MeanCreditScore vs BorrowerRate
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_Rate}
cor.test(pd$MeanCreditScore, pd$BorrowerRate)

ggplot(aes(x = BorrowerRate, y = MeanCreditScore),
       data = subset(pd, !is.na(BorrowerRate))) +
  scale_x_sqrt()+
  geom_line(stat='summary', fun.y=median, fun.x=median) +
  coord_cartesian(ylim = c(400,850)) + 
  geom_smooth()

ggplot(data = subset(pd, !is.na(BorrowerRate)), 
       aes(x = BorrowerRate, y = MeanCreditScore)) +
      geom_smooth()

qplot(data= subset(pd, !is.na(BorrowerRate)), x = BorrowerRate) +
  facet_wrap(~MeanCreditScore)
```

The correlation shows a negative relation of -0.46 as we had seen in the correlation matrix.
The chart shows a negative relation, except when the interest rate is less than around 0.6% where it shows a sharp increase in the trend. Hence it can be deduced that a very small interest rate is good for the credit score to a threshold after which the credit score declines.

The facet wrap graph histogram shows an approximate normal distribution for loan counts in 650 to 750 range and for higher credit scores the distribution is right skewed due to lower rate charged for them.

#### MeanCreditScore vs DebtToIncomeRatio
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_DTI}
cor.test(pd$MeanCreditScore, pd$DebtToIncomeRatio)

ggplot(aes(x = DebtToIncomeRatio, y = MeanCreditScore),
       data = subset(pd, !is.na(DebtToIncomeRatio))) +
  scale_x_sqrt()+
  geom_line(stat='summary', fun.y=median, fun.x=median) +
  coord_cartesian(ylim = c(400,850)) + 
  geom_smooth()

ggplot(data = subset(pd, !is.na(ProsperCreditRating)), 
       aes(x = DebtToIncomeRatio, y = MeanCreditScore)) +
      geom_smooth()
```

I see a very small negative correlation and no strong relationship between DebtToIncomeRatio and MeanCreditScore. The second curve also shows a very non-obvious relationship. I was expecting the credit score to fall with a rising debt to income ratio, but since there are many other factors considered to calculate the credit score, from the data we have, the DebtToIncome ratio doesn't seem to be playing a role.

Changing the gears a bit, I compare the newly created Occupation_new categorical variable with the StatedMonthlyIncome to understand whether my intuition regarding categorization on multiple occupation categories in the dataset was correct or not.

#### StatedMonthlyIncome vs Occupation_new
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_Income}
ggplot(data=subset(pd, !is.na(Occupation_new)),
       aes(x=Occupation_new,y=StatedMonthlyIncome))+
  geom_boxplot(aes(colour=Occupation_new)) +
  scale_y_log10() +
  theme(axis.text.x = 
          element_text(face="bold", size=10, angle = 60, hjust = 1))
  coord_cartesian(ylim = c(1000,20000))
```

It can be observed from the box plot, that monthly income is highest for the Distinguished Service, followed by STEM related services, Medical services respectively. As expected Students are the lowest earners. 
I will now try to pair the Occupation_new with MeanCreditScore to get a roughly similar relationship.

#### MeanCreditScore vs Occupation_new
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_Occup}
ggplot(data=subset(pd, !is.na(Occupation_new)),aes(x=Occupation_new,y=MeanCreditScore))+
  geom_boxplot(aes(colour=Occupation_new)) +
  theme(axis.text.x = 
          element_text(face="bold", size=10, angle = 60, hjust = 1))
  coord_cartesian(ylim = c(600,800))
```

Filtering out the outliers, the box plots fpr MeanCreditScore show a similar relationship as was with the StatedMonthlyIncome. Although since the range for credit score is much lower than the income the differences aren't very clear looking at the 1st and 3rd quantiles of the box plots.

#### MeanCreditScore vs ProsperCreditRating
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_Rating}
ggplot(data=subset(pd, !is.na(ProsperCreditRating)),aes(x=ProsperCreditRating,y=MeanCreditScore))+
  geom_boxplot(aes(colour=ProsperCreditRating)) +
  coord_cartesian(ylim = c(600,800)) +
    scale_y_continuous(limits = c(quantile(pd$MeanCreditScore, 0.05, na.rm=T), 
                                quantile(pd$MeanCreditScore, 0.95, na.rm=T)))

qplot(data= subset(pd, !is.na(MeanCreditScore)), x = ProsperCreditRating) +
  facet_wrap(~MeanCreditScore)

ggplot(data=subset(pd, !is.na(MeanCreditScore)),aes(x=MeanCreditScore))+
  geom_histogram(binwidth=10, position = "identity")+
  #scale_y_log10()+
  facet_wrap(~ProsperCreditRating,3)
```

I charted two different types of graphs, a box plot and a facet wrap. In the box plot it can be seen that  median credit score is highest for AA and then it goes down for A, B upto E. The median for HR is higher than E's median due to outliers with very high MeanCreditScore.

The facet chart shows an approximate normal distribution for ProsperCreditRating categories for  MeanCreditScore present in the range 650 to 750. At higher credit score we can see the distribution tending to be right skewed due to dwindling number with poor Prosper ratings at higher MeanCreditScore.

#### MonthlyLoanPayment vs MeanCreditScore
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_Payment}
cor.test(pd$MeanCreditScore, pd$MonthlyLoanPayment)

ggplot(aes(x = MonthlyLoanPayment, y = MeanCreditScore),
       data = subset(pd, !is.na(MonthlyLoanPayment))) +
  scale_x_sqrt()+
  geom_line(stat='summary', fun.y=median) +
  coord_cartesian(ylim = c(400,850)) + 
  geom_smooth()

ggplot(data = subset(pd, !is.na(MonthlyLoanPayment)), 
       aes(x = MonthlyLoanPayment, y = MeanCreditScore)) +
      geom_smooth()

```

The correlation shows a value of around 0.3 which is also reflected in the 2 charts that follow.

#### MeanCreditScore vs Term
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_Term}
cor.test(pd$MeanCreditScore, pd$Term)
ggplot(data = subset(pd, !is.na(Term)), 
  aes(x = as.factor(Term), y = MeanCreditScore)) +
  geom_boxplot() + 
  scale_y_continuous(limits = c(quantile(pd$MeanCreditScore, 0.05, na.rm=T), 
                                quantile(pd$MeanCreditScore, 0.95, na.rm=T)))
```

The correlation is very low at 0.12. The box plot shows that for loans of shorter term as well as longer term the MeanCreditScore is higher, with a greater inter-quartile range for 12 month term. The loan term of 36 months is much larger in number of loans and correlate with a larger range of credit score even though the interquartile range is smaller.

#### MeanCreditScore vs LoanStatus
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path= 'cache/', fig.path='figure/', Bivar_Status}
ggplot(data = subset(pd, !is.na(LoanStatus)), 
       aes(x = as.factor(LoanStatus), y = MeanCreditScore)) +
  geom_boxplot(aes(colour=LoanStatus)) + 
  scale_y_continuous(limits = c(quantile(pd$MeanCreditScore, 0.05, na.rm=T), 
                                quantile(pd$MeanCreditScore, 0.95, na.rm=T))) +
  theme(axis.text.x = 
          element_text(face="bold", size=10, angle = 60, hjust = 1))

```

The categorical variable LoanStatus shows an obvious relationship with MeanCreditScore. The credit score is high for Current and Completed loans. But for Charged-off and Defaulted loans are clearly lower. The Past Due categories are flat across the 6 past due categories. An interesting thing to note is that for FinalPaymentInProgress and Completed loans the credit scores are lower than Current loans.

#### MeanCreditScore vs BankcardUtilization
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Bivar_Bankcard}
summary(pd$BankcardUtilization)
cor.test(pd$MeanCreditScore, pd$BankcardUtilization)
ggplot(subset(pd, !is.na(BankcardUtilization)),
       aes(x=BankcardUtilization, y=MeanCreditScore))+
  xlim(quantile(pd$BankcardUtilization,0.05, na.rm=T), 
       quantile(pd$BankcardUtilization,0.95, na.rm=T))+
  geom_jitter(alpha=0.05) +  
  geom_smooth(method = 'lm', color= 'red')

```

A slight negative trend is visible for the greater usage of the credit brings down the credit score.

#### MeanCreditScore vs OpenRevolvingMonthlyPayment
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Bivar_Revol}
summary(pd$OpenRevolvingMonthlyPayment)
cor.test(pd$MeanCreditScore, pd$OpenRevolvingMonthlyPayment)
ggplot(subset(pd, !is.na(BankcardUtilization)),
       aes(x=OpenRevolvingMonthlyPayment, y=MeanCreditScore))+
  xlim(quantile(pd$OpenRevolvingMonthlyPayment,0.05, na.rm=T), 
       quantile(pd$OpenRevolvingMonthlyPayment,0.95, na.rm=T))+
  geom_jitter(alpha=0.05)+
  coord_cartesian(ylim = c(300,800)) +
  geom_smooth(method = 'lm', color= 'red')

ggplot(aes(x = OpenRevolvingMonthlyPayment, y = MeanCreditScore),
       data = subset(pd, !is.na(OpenRevolvingMonthlyPayment))) +
  scale_x_sqrt()+
  geom_line(stat='summary', fun.y=median) +
  coord_cartesian(ylim = c(400,850)) + 
  geom_smooth()

```

A slight positive trend is visible here, signifying that an increase in revolving monthly payment results in higher credit usage and hence lower credit score.

#### MeanCreditScore vs LoanMonthsSinceOrigination
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Bivar_DT}

ggplot(aes(x = LoanMonthsSinceOrigination, y = MeanCreditScore),
       data = subset(pd, !is.na(LoanMonthsSinceOrigination))) +
  scale_x_sqrt()+
  geom_line(stat='summary', fun.y=median) +
  coord_cartesian(ylim = c(400,850)) + 
  geom_smooth()
```

An interesting trend can be seen in this plot that given that there are just 3 loan terms, 12, 36 and 60 months. And hence all the loans with LoanMonthsSinceOrigination greater than 60 show a steady decline in their credit scores. The score remains roughly around 700 till about 60 month mark. we can correlate this to the LoanStatus with Past Due status which have low credit scores.

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

I got a rough idea about relationships among continuous variables by using the correlation matrix plot. I then eliminated some of the variables based on the result of correlation matrix and compared relationships between pairs of variables of my interest.
My primary variable of interest in this analysis was MeanCreditScore which I paired with LoanOriginalAmount, BorrowerRate, DebtToIncomeRatio, ProsperCreditRating, Occupation_new, MonthlyLoanPayments, Term, LoanStatus and BankCardUtilization. I used multiple plot types to analyze the variables such as line, box, point or scatter plots and facet grids.

Some relatively strong relationships of MeanCreditScore are with BankCardUtilization, LoanOriginalAmount, BorrowerRate and MonthlyLoanPayment which shows that taking loan helps the credit score and as long as the loan is serviced responsibly. Greater the loan amount and greater the monthly payments, better is the score. The BorrowerRate which is a measure of risk associated with the loan, is overall negatively related to MeanCreditScore. Although there is a threshold, upto which an increase in BorrowerRate increases the credit score.

On relationships with the categorical variables such as Occupation_new, ProsperCreditRating, LoanStatus, I found them to be as expected. On LoanStatus although I saw that once the loan is Completed or about to be completed the credit score tends to fall below those who's status is current.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

I tried to see the relationship between StatedMonthlyIncome and Occupation_new to understand if my inuition regarding the payscale of different broader occupation types was correct. More or less my intuition turned out to be correct although I can't say for sure that it was 100% accurate.

### What was the strongest relationship you found?

Relationship of BorrowerRate with MeanCreditScore showed the strongest relationship among variables of my interest.

# Multivariate Plots Section

#### ProsperRating vs LoanOriginalAmount vs Term
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Multivar_1}
ggplot(aes(x=factor(ProsperRating..numeric.), 
           y= LoanOriginalAmount,Term, fill = factor(Term)), 
        data = subset(pd, !is.null(ProsperCreditRating))) +
  geom_boxplot( alpha = .5)
```
#### MeanCreditScore, BorrowerRate, ProsperCreditRating
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Multivar_1}
ggplot(data = subset(pd, !is.null(ProsperCreditRating)), 
       aes(x = BorrowerRate, y = MeanCreditScore)) +
  coord_cartesian(xlim = c(quantile(pd$BorrowerRate, 0.025, na.rm=T), 
                           quantile(pd$BorrowerRate, 0.975,na.rm=T)),
                  ylim = c(quantile(pd$MeanCreditScore, 0.025,na.rm=T),
                           quantile(pd$MeanCreditScore, 0.975,na.rm=T))) +
  geom_smooth(aes(color=ProsperCreditRating)) + facet_wrap(~pd$Term)
```
Since 36 month term loans are more in number we can see the range of BorrowerRates covered is greater.
This plot shows an interesting finding that for higher credit ratings, which correspond to higher credit scores the plot with borrower rate is flat, where as for lower credit rated loans, if the borrower rate is higher the scores tend to be higher and vice versa. Hence if a lower credit rated loan is charged a higher rate then the credit scores would also increase. Now I'll replace credit rating with Occupation_new and see the trend.

#### MeanCreditScore, BorrowerRate, Occupation_new
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Multivar_2}
ggplot(data = subset(pd, !is.null(Occupation_new)), 
       aes(x = BorrowerRate, y = MeanCreditScore)) +
  coord_cartesian(xlim = c(quantile(pd$BorrowerRate, 0.025, na.rm=T), 
                           quantile(pd$BorrowerRate, 0.975,na.rm=T)),
                  ylim = c(quantile(pd$MeanCreditScore, 0.025,na.rm=T),
                           quantile(pd$MeanCreditScore, 0.975,na.rm=T))) +
  geom_smooth(aes(color=Occupation_new))

ggplot(data = subset(pd, !is.null(Occupation_new)), 
       aes(x = BorrowerRate, y = MeanCreditScore)) +
  coord_cartesian(xlim = c(quantile(pd$BorrowerRate, 0.025, na.rm=T), 
                           quantile(pd$BorrowerRate, 0.975,na.rm=T)),
                  ylim = c(quantile(pd$MeanCreditScore, 0.025,na.rm=T),
                           quantile(pd$MeanCreditScore, 0.975,na.rm=T))) +
  geom_smooth(aes(color=Occupation_new)) + facet_wrap(~IncomeRange)
```

Most of the categories show a similar trend, except the Other (most loans in this Occupation category) which shows a dip in credit score till about 0.26 borrower rate and then a rise. For others as the borrower rate increases the credit score decreases. Student category is clearly lower compared to others which are grouped closely together in the plot.

In the 2nd plot I further divide the plots using income ranges, Students are dominant in 0-25k income range. Interestingly there is nothing plotted in 75-100k income range.

#### MeanCreditScore, LoanOriginalAmount and ProsperCreditRating
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Multivar_3}

ggplot(aes(x = MeanCreditScore, y = LoanOriginalAmount),
       data = subset(pd, !is.missing(ProsperCreditRating))) +
  scale_y_sqrt()+
  geom_line(aes(color=ProsperCreditRating), stat='summary', fun.y=median) +
  geom_smooth(aes(color=ProsperCreditRating), fun.y=median) +
  coord_cartesian(xlim = c(400,850))  

ggplot(data = subset(pd, !is.null(ProsperCreditRating)), 
       aes(x = LoanOriginalAmount, y = MeanCreditScore)) +
  coord_cartesian(xlim = c(quantile(pd$LoanOriginalAmount, 0.025, na.rm=T), 
                           quantile(pd$LoanOriginalAmount, 0.975, na.rm=T)),
                  ylim = c(quantile(pd$MeanCreditScore, 0.025, na.rm=T),
                           quantile(pd$MeanCreditScore, 0.975, na.rm=T))) +
  geom_smooth(aes(color=ProsperCreditRating)) +
  theme(axis.text.x = 
          element_text(face="bold", size=10, angle = 60, hjust = 1)) +
  scale_x_sqrt() + facet_wrap(~Term)

```

In the couple of charts above I tried to triangulate between 3 variables. The first plot is a line plot of different credit ratings, plotting loan amount vs credit scores. The geom_smooth helps to understand the trends in the busy plot and the trends are obvious and clearly visible.

#### MeanCreditScore, LoanOriginalAmount by EmploymentStatus
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Multivar_4}

ggplot(aes(y = MeanCreditScore, x = LoanOriginalAmount),
       data = subset(pd, !is.missing(EmploymentStatus))) +
  scale_x_sqrt()+
  geom_line(aes(color=EmploymentStatus), stat='summary', fun.y=median) +
  geom_smooth(aes(color=EmploymentStatus), fun.y=median) +
  coord_cartesian(ylim = c(400,850)) 
```

Full-time, Employed and Other categories seem to be getting higher loan amounts and are having higher credit scores. Although Self-employed and Not-available categories have limited access to loan amount beyond around 250k, their median credit scores tend to be slightly higher than other categories.

#### MeanCreditScore, StatedMonthlyIncome, EmploymentStatus, Term
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Multivar_5}
ggplot(aes(y = MeanCreditScore, x = StatedMonthlyIncome),
       data = subset(pd, !is.missing(EmploymentStatus))) +
  geom_smooth(aes(color=EmploymentStatus), fun.y=median) +
  coord_cartesian(xlim = c(quantile(pd$StatedMonthlyIncome, 0.025, na.rm=T), 
                           quantile(pd$StatedMonthlyIncome, 0.975, na.rm=T)),
                  ylim = c(quantile(pd$MeanCreditScore, 0.025, na.rm=T),
                           quantile(pd$MeanCreditScore, 0.975, na.rm=T))) +
  facet_wrap(~Term)

```

In the plot above I have tried to see the relation between monthly income, credit score based on employment status and term of the loan. I limited the x and y axes to remove extreme outliers seen in the StatedMonthlyIncome. The credit score can be seen to rise with with income. Full-time and employed tend to have a higher score even for lower salaries due to stability of cash flow to service the loan. The curves are not relatively flat for other categories showing a sharper rise with the income. The variance in slope of different employment status is not as big in loan categories 12 and 60 months.

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

In this section of the project I tried to bring together multiple variables of interest and see relations among 3-4 variables at a time and understand finer nuances of interplay among them. Since the MeanCreditScore is the main variable of my interest, it almost always occupied the y axis. I checked BorrowerRate, LoanOriginalAmount, and StatedMonthlyIncome against the MeanCreditScore and further added catagorical variables such as ProsperCreditRating, EmploymentStatus, IncomeRange, Term and Occupation_new.
In most plots my previous understanding about relationships among the variables was reaffirmed. 

### Were there any interesting or surprising interactions between features?

Some of the interesting findings were as below:
I observed sharp rise in credit score, when borrower rate was increased for poorly rated loans.
A similar sharp rise is observed whtn monthly income is increase for poorly rated loans.
The 'Other' category in Occupation_new showed a strange U pattern as the borrower rate was increased. I think this category should be broken down furhter to analyze the reason for this behavior.
Not all employment status categories were granted loans of value greater than 250k

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Plot_One}

p11 <- ggplot(data = subset(pd, !is.na(Term)), 
  aes(x = as.factor(Term), y = MeanCreditScore, fill=as.factor(Term))) +
  geom_boxplot() + 
  scale_y_continuous(limits = c(quantile(pd$MeanCreditScore, 0.05, na.rm=T), 
                                quantile(pd$MeanCreditScore, 0.95, na.rm=T))) +
  ggtitle("Credit Scores by Loan Term") +
  ylab("Credit Score") +
  xlab("Term") +
  guides(fill=FALSE) +
  scale_fill_brewer(palette="RdBu") #GnBU

p12 <- ggplot(data = subset(pd, !is.na(ProsperCreditRating)), 
  aes(x = as.factor(ProsperCreditRating), y = MeanCreditScore, 
      fill=as.factor(ProsperCreditRating))) +
  geom_boxplot() + 
  scale_y_continuous(limits = c(quantile(pd$MeanCreditScore, 0.05, na.rm=T), 
                                quantile(pd$MeanCreditScore, 0.95, na.rm=T))) +
  ggtitle("Credit Scores by CreditRating") +
  ylab("Credit Score") +
  xlab("Credit Rating") +
  guides(fill=FALSE)

p13 <- ggplot(data = subset(pd, !is.na(IsBorrowerHomeowner)), 
  aes(x = as.factor(IsBorrowerHomeowner), y = MeanCreditScore, 
      fill=as.factor(IsBorrowerHomeowner))) +
  geom_boxplot() + 
  scale_y_continuous(limits = c(quantile(pd$MeanCreditScore, 0.05, na.rm=T), 
                                quantile(pd$MeanCreditScore, 0.95, na.rm=T))) +
  ggtitle("Credit Scores by Home ownership") +
  ylab("Credit Score") +
  xlab("Is Borrower Home Owner") +
  guides(fill=FALSE)

p14 <- ggplot(data = subset(pd, !is.na(IncomeRange)), 
  aes(x = as.factor(IncomeRange), y = MeanCreditScore, 
      fill=as.factor(IncomeRange))) +
  geom_boxplot() + 
  scale_y_continuous(limits = c(quantile(pd$MeanCreditScore, 0.05, na.rm=T), 
                                quantile(pd$MeanCreditScore, 0.95, na.rm=T))) +
  theme(axis.text.x = element_text(size=10, angle = 60, hjust = 1)) +
  ggtitle("Credit Scores by Income Range") +
  ylab("Credit Score") +
  xlab("Income Range") +
  guides(fill=FALSE)

grid.arrange(p11, p12,
            top = "Credit Scores from Categorical Variable Perspective" )
grid.arrange (p13, p14)
```

### Description One
The grid of graphs above depicts the variations of credit scores with different categorical variables that I explored in my analysis above. It can be seen that credit rating category on the loan is an important determinant when deciding the credit score of an individual. Similarly the home ownership as well creates a stark distinction in the credit scores. Although there are overlaps among all categories in the plots, when it comes to comparing medians the distinction is obvious and clearly visible. When looking at them invidually the variations in credit scores point to obvious finding when it comes to determining credit scores, except in case of Term where the 36 month loans have a lower median credit scores where as the other 2  terms have higher medians. This can be explained by the fact that a considerably large number of loans are 36 month term which covers a broader category of borrowers including relatively higher number of non performing loans and leading to lower scores of borrowers.

### Plot Two
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Plot_Two, fig.height=6, fig.width=10}
secPalette <- c("#000000", "#0000FF", "#00FF00", "#FF0000", "#00FFFF", 
                "#FFFF00", "#FF00FF", "#FFFFFF")

p21 <- ggplot(aes(x=BorrowerRate, y=MeanCreditScore), 
       data=subset(pd, !is.na(BorrowerRate))) + 
  geom_jitter(alpha=0.20, aes(color=IncomeRange)) +
  scale_colour_manual(values=secPalette) +
  geom_smooth(aes(color=IncomeRange)) +
  ylab("Credit Score") +
  xlab("Borrower Rate") +
  ggtitle("Credit Scores by Borrower Rate for different Income Ranges") 

p22 <- ggplot(aes(x=MonthlyLoanPayment, y=MeanCreditScore), 
       data=subset(pd, !is.na(MonthlyLoanPayment))) + 
  geom_jitter(alpha=0.20, aes(color=IncomeRange)) +
  scale_colour_manual(values=secPalette) +
  geom_smooth(aes(color=IncomeRange)) +
  ylab("Credit Score") +
  xlab("Monthly Payment") +
  ggtitle("Credit Scores by Monthly Payments for different Income Ranges") 

grid.arrange(p21, p22, 
             top = "Credit Scores from Categorical Variable Perspective")

```

### Description Two

In this grid of graphs I compare the borrower rate (BorrowerRate), which showed high correlation with credit score, and monthly loan payments (MonthlyLoanPayment) for different income ranges. BorrowerRate is negatively correlated with the credit scores. As seen earlier for lower band of income ranges the credit score rises with the rise in borrower rate before reaching a threshold after which it drops. The rise and drop are sharper in case of "Not Displayed" category of income range who can represent more risky borrowers and are not much interested in revealing their income information. For higher income ranges there is a steady decline with borrower rate. Although at higher rates the income range becomes immaterial. 

In the 2nd plot in the grid, the increase in monthly payment helps the credit score and more so for the relatively more risky borrowers in "Not Displayed" income range category, which shows a sharper rise in credit scores. From the line plots it can also be seen that different income ranges are able to afford monthly payments proportional to their earning capacity and the curves stop plotting beyond a particular monthly payment, for e.g. the 10,000+ goes farthest while 25-50k income range goes only upto about 1200.

### Plot Three
```{r echo=FALSE, warning=FALSE, message=FALSE, cache=TRUE, cache.path = 'cache/', fig.path='figure/', Plot_Three, fig.height=9, fig.width=11}
thPalette <- c("#000000", "#0000FF", "#00FF00", "#00FFFF", "#FF0000", "#F0F0F0", "#FF00FF", "#FFFF00", "#FFFFFF")
ggplot(data = subset(pd, !is.null(ProsperCreditRating)), 
       aes(x = LoanMonthsSinceOrigination, y = MeanCreditScore)) +
  coord_cartesian(xlim = 
                    c(quantile(pd$LoanMonthsSinceOrigination, 0.025, na.rm=T), 
                    quantile(pd$LoanMonthsSinceOrigination, 0.975,na.rm=T)),
                  ylim = 
                    c(quantile(pd$MeanCreditScore, 0.025,na.rm=T),
                    quantile(pd$MeanCreditScore, 0.975,na.rm=T))) +
  scale_colour_manual(values=thPalette) +
  geom_smooth(aes(color=ProsperCreditRating)) + facet_wrap(~pd$IncomeRange) +
  ylab("Credit Score") +
  xlab("Loan Age in Months") +
  ggtitle("Credit Scores by Loan Age for different Credit Ratings and 
          Income Ranges") 

```

### Description Three

In this plot I try to relate the credit score with loan ages. In the bivariate plot analyis I observed that after an age of 60 months, which is the maximum term for loan age the credit scores dropped sharply. In this plot I have further segmented the loans by credit rating and also for different income ranges. Interesting to note is the pattern of fall of credit scores for different credit ratings. The decline is sharper for B, C, D, E and HR in the order. On the other hand AA and A credit rated loan borrowers are able to maintain their credit scores even if they are past due.  The "Not Displayed" category only shows loans which seem to be past due although and flat credit scores. 

------

# Reflection

This has been quite an overwhelming exercise of trying to find relationships among diferent features of a dataset using plots, given that there are 81 features to be analysed. The size of dataset which has more than 110,000 records is large enough to help me find patters without feeling the need for more data to analyze which can be the case sometimes with smaller datasets. I have tried to find factors affecting the credit scores of borrowers based on my past understaning of this subject and reconfirming those assumptions during analysis of this dataset. Although it will require much more reverse engineering process to know the recepie with all the ingredients and proportions of all the features required to determine the credit score. 

To summarize my process in this analysis was to categorize the 81 variables into broader categories and then create a list of variables that I would use, analyze them individually and then in pairs or triplets to lead me to intresting insights. In the process I created more features, experimented with different plot types and documented my findings. There is still a lot more that can be done with the data and I think I have just touched the surface. 

For further analysis I would try to work with loan origination dates to see the trends of multiple variables over a period of time. Also can be factored in, the economic events during the period these loans were being serviced. I have also ignored the investor side of the story, who or how many people are investing and how much. What kinds of profits or losses they are experiencing. As an overall measure we can also come up with a meature of how successful the Prosper platform has been, is the rising volumes of loans is a good enough measure for success or whether is certainly creating a win-win situation for all the stakeholders in the arena.